sap.ui.define([                                                                                                                                                                                                                                                
		"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                
		"sap/ui/core/Fragment",                                                                                                                                                                                                                                      
		"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                               
		"sap/m/MessageBox",                                                                                                                                                                                                                                          
		"sap/ui/model/Filter",                                                                                                                                                                                                                                       
		"sap/ui/model/FilterOperator"                                                                                                                                                                                                                                
	], function (Controller, Fragment, JSONModel, MessageBox, Filter, FilterOperator) {                                                                                                                                                                           
		"use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
		return Controller.extend("com.codilog.controller.BaseController", {                                                                                                                                                                                          
			/**                                                                                                                                                                                                                                                         
			 * Convenience method for accessing the router.                                                                                                                                                                                                             
			 * @public                                                                                                                                                                                                                                                  
			 * @returns {sap.ui.core.routing.Router} the router for this component                                                                                                                                                                                      
			 */                                                                                                                                                                                                                                                         
			getRouter : function () {                                                                                                                                                                                                                                   
				return sap.ui.core.UIComponent.getRouterFor(this);                                                                                                                                                                                                         
			},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			/**                                                                                                                                                                                                                                                         
			 * Convenience method for getting the view model by name.                                                                                                                                                                                                   
			 * @public                                                                                                                                                                                                                                                  
			 * @param {string} [sName] the model name                                                                                                                                                                                                                   
			 * @returns {sap.ui.model.Model} the model instance                                                                                                                                                                                                         
			 */                                                                                                                                                                                                                                                         
			getModel : function (sName) {                                                                                                                                                                                                                               
				return this.getView().getModel(sName);                                                                                                                                                                                                                     
			},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			/**                                                                                                                                                                                                                                                         
			 * Convenience method for setting the view model.                                                                                                                                                                                                           
			 * @public                                                                                                                                                                                                                                                  
			 * @param {sap.ui.model.Model} oModel the model instance                                                                                                                                                                                                    
			 * @param {string} sName the model name                                                                                                                                                                                                                     
			 * @returns {sap.ui.mvc.View} the view instance                                                                                                                                                                                                             
			 */                                                                                                                                                                                                                                                         
			setModel : function (oModel, sName) {                                                                                                                                                                                                                       
				return this.getView().setModel(oModel, sName);                                                                                                                                                                                                             
			},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			/**                                                                                                                                                                                                                                                         
			 * Getter for the resource bundle.                                                                                                                                                                                                                          
			 * @public                                                                                                                                                                                                                                                  
			 * @returns {sap.ui.model.resource.ResourceModel} the resourceModel of the component                                                                                                                                                                        
			 */                                                                                                                                                                                                                                                         
			getResourceBundle : function () {                                                                                                                                                                                                                           
				return this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                                      
			},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
			/**                                                                                                                                                                                                                                                         
			 * Event handler when the share by E-Mail button has been clicked                                                                                                                                                                                           
			 * @public                                                                                                                                                                                                                                                  
			 */                                                                                                                                                                                                                                                         
			onShareEmailPress : function () {                                                                                                                                                                                                                           
				var oViewModel = (this.getModel("objectView") || this.getModel("worklistView"));                                                                                                                                                                           
				sap.m.URLHelper.triggerEmail(                                                                                                                                                                                                                              
					null,                                                                                                                                                                                                                                                     
					oViewModel.getProperty("/shareSendEmailSubject"),                                                                                                                                                                                                         
					oViewModel.getProperty("/shareSendEmailMessage")                                                                                                                                                                                                          
				);                                                                                                                                                                                                                                                         
			},                                                                                                                                                                                                                                                          
			                                                                                                                                                                                                                                                            
			onStorageLocValueHelpRequested: function (oEvent) {                                                                                                                                                                                                         
				this.openGenericValueHelpDialog("StorageLoc", oEvent);		                                                                                                                                                                                                   
			},                                                                                                                                                                                                                                                          
			                                                                                                                                                                                                                                                            
			openGenericValueHelpDialog: function(sType, oEvent, sKeyBinding, sSecondaryBinding, bIsInt) {                                                                                                                                                               
			if (!this._oValueHelpDialog) {                                                                                                                                                                                                                              
				this._oValueHelpDialog = sap.ui.xmlfragment("sIdDialogValueHelp", "com.codilog.view.fragment.DialogValueHelp", this);                                                                                                                                      
				this.getView().addDependent(this._oValueHelpDialog);                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			                                                                                                                                                                                                                                                            
			var sFilters = oEvent.getSource().data("Filters");                                                                                                                                                                                                          
			var oSelectDialog = Fragment.byId("sIdDialogValueHelp", "vhSelectDialog");                                                                                                                                                                                  
			var oTemplate;                                                                                                                                                                                                                                              
			var iDelay;                                                                                                                                                                                                                                                 
			var aFilters = [];                                                                                                                                                                                                                                          
			                                                                                                                                                                                                                                                            
			this._sCurrentVHType = sType;                                                                                                                                                                                                                               
			this._sCurrentVHInput = oEvent.getSource();                                                                                                                                                                                                                 
			this._bIsInt = bIsInt;                                                                                                                                                                                                                                      
			this._sKeyBinding = sKeyBinding;                                                                                                                                                                                                                            
			this._sSecondaryBinding = sSecondaryBinding;                                                                                                                                                                                                                
			                                                                                                                                                                                                                                                            
			if (sFilters) {                                                                                                                                                                                                                                             
				aFilters.push(new Filter("Filter", FilterOperator.EQ, sFilters));                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			                                                                                                                                                                                                                                                            
			aFilters.push(new Filter("Type", FilterOperator.EQ, sType));                                                                                                                                                                                                
			                                                                                                                                                                                                                                                            
			oTemplate = new sap.m.StandardListItem({                                                                                                                                                                                                                    
					title: "{Key} - {Description1}",                                                                                                                                                                                                                          
					description: "{= ${Description3} ? ${Description2} + ' | ' + ${Description3} : ${Description2} } ",                                                                                                                                                       
                    icon: "{= ${Indicator} ? 'sap-icon://decline':'' }"&nbsp;&nbsp;&nbsp;                                                                                                                                                                      
			});                                                                                                                                                                                                                                                         
			iDelay = 400;                                                                                                                                                                                                                                               
			                                                                                                                                                                                                                                                            
			oSelectDialog.bindAggregation("items", {                                                                                                                                                                                                                    
				path: "/ValueHelpSet",                                                                                                                                                                                                                                     
				filters: aFilters,                                                                                                                                                                                                                                         
				template: oTemplate                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
			                                                                                                                                                                                                                                                            
			                                                                                                                                                                                                                                                            
			var oVHDialogModel = new JSONModel({                                                                                                                                                                                                                        
				MultiSelect: false                                                                                                                                                                                                                                         
			});                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			if( this._sCurrentVHInput.getMetadata().getName() === 'sap.m.MultiInput'){                                                                                                                                                                                  
				oVHDialogModel.setProperty("/MultiSelect", true);                                                                                                                                                                                                          
			}	                                                                                                                                                                                                                                                          
			                                                                                                                                                                                                                                                            
			this._oValueHelpDialog.setModel(oVHDialogModel, "vhDialogModel");                                                                                                                                                                                           
			this._oValueHelpDialog.open();                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			this.getOwnerComponent().getModel().attachEventOnce("requestCompleted", function() {                                                                                                                                                                        
				var oSFDOM = this._oValueHelpDialog.$().find(".sapMSF");                                                                                                                                                                                                   
				var oID = oSFDOM[0].id;                                                                                                                                                                                                                                    
				var oSearchField = sap.ui.getCore().byId(oID);                                                                                                                                                                                                             
				jQuery.sap.delayedCall(iDelay, null, function() {                                                                                                                                                                                                          
					oSearchField.focus();                                                                                                                                                                                                                                     
				});                                                                                                                                                                                                                                                        
			}.bind(this));                                                                                                                                                                                                                                              
			                                                                                                                                                                                                                                                            
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onValueHelpSearch: function(oEvent) {                                                                                                                                                                                                                        
			var sFilter = oEvent.getParameter("value");                                                                                                                                                                                                                 
			var oItemBinding = oEvent.getParameter("itemsBinding");                                                                                                                                                                                                     
	     	var sDependantFilters = this._sCurrentVHInput.data("Filters");                                                                                                                                                                                          
			var aFilter = [new Filter("Type", FilterOperator.EQ, this._sCurrentVHType)];                                                                                                                                                                                
			                                                                                                                                                                                                                                                            
			if (sDependantFilters) {                                                                                                                                                                                                                                    
				aFilter.push(new Filter("Filter", FilterOperator.EQ, sDependantFilters));                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			if (sFilter !== "") {                                                                                                                                                                                                                                       
				aFilter.push(new Filter("Filter1", FilterOperator.EQ, sFilter));                                                                                                                                                                                           
			}                                                                                                                                                                                                                                                           
			                                                                                                                                                                                                                                                            
			oItemBinding.filter(aFilter, "Application");                                                                                                                                                                                                                
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onValueHelpClose: function(oEvent) {                                                                                                                                                                                                                         
			var sValue;                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			if (this._sCurrentVHInput.getMetadata().getName() === "sap.m.MultiInput") {                                                                                                                                                                                 
				                                                                                                                                                                                                                                                           
				var aSelectedItems = oEvent.getParameter("selectedItems");                                                                                                                                                                                                 
				var sTokensContextPath = this._sCurrentVHInput.getBinding("tokens").sPath;&nbsp;                                                                                                                                                                           
				var aCurrTokens = this._sCurrentVHInput.getBinding("tokens").getModel().getObject(sTokensContextPath);	                                                                                                                                                    
				                                                                                                                                                                                                                                                           
				aSelectedItems.forEach(function(oSelectedItem) {&nbsp;                                                                                                                                                                                                     
					var found = false;                                                                                                                                                                                                                                        
					aCurrTokens.forEach(function(element) {                                                                                                                                                                                                                   
						if( element.Key === oSelectedItem.getBindingContext().getProperty("Key")){                                                                                                                                                                               
							found = true;                                                                                                                                                                                                                                           
							return;                                                                                                                                                                                                                                                 
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
					if(!found){                                                                                                                                                                                                                                               
						aCurrTokens.push({                                                                                                                                                                                                                                       
							Key: oSelectedItem.getBindingContext().getProperty("Key"),                                                                                                                                                                                              
							Description1: oSelectedItem.getBindingContext().getProperty("Description1")&nbsp;                                                                                                                                                                       
						});					                                                                                                                                                                                                                                                 
					                                                                                                                                                                                                                                                          
//						this._sCurrentVHInput.addToken(new sap.m.Token({                                                                                                                                                                                                       
//								key:  oSelectedItem.getBindingContext().getProperty("Key"),                                                                                                                                                                                          
//								text: oSelectedItem.getBindingContext().getProperty("Description1")                                                                                                                                                                                  
//						}));                                                                                                                                                                                                                                                   
					}	                                                                                                                                                                                                                                                        
				}.bind(this));                                                                                                                                                                                                                                             
	//			this._sCurrentVHInput.getBinding("tokens").getModel().setProperty (sTokensContextPath, aCurrTokens);	                                                                                                                                                    
				this._sCurrentVHInput.fireTokenUpdate();	                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
			else {                                                                                                                                                                                                                                                      
				                                                                                                                                                                                                                                                           
				var oCurrentContext = this._sCurrentVHInput.getBinding("value").getContext(),                                                                                                                                                                              
			    	oCurrentModel = this._sCurrentVHInput.getBinding("value").getModel(),                                                                                                                                                                                  
				    oSourceBindingName = this._sCurrentVHInput.getBinding("value").getPath();                                                                                                                                                                              
				                                                                                                                                                                                                                                                           
				if (oEvent.getParameter("selectedItem")) {                                                                                                                                                                                                                 
					if( this._sKeyBinding ){                                                                                                                                                                                                                                  
						sValue = oEvent.getParameter("selectedItem").getBindingContext().getProperty("Description1");                                                                                                                                                            
						if (this._bIsInt) {                                                                                                                                                                                                                                      
							sValue = parseInt(sValue, 10);                                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						oCurrentModel.setProperty(oSourceBindingName, sValue, oCurrentContext);                                                                                                                                                                                  
						sValue = oEvent.getParameter("selectedItem").getBindingContext().getProperty("Key");                                                                                                                                                                     
						if (this._bIsInt) {                                                                                                                                                                                                                                      
							sValue = parseInt(sValue, 10);                                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						if(!oCurrentContext){                                                                                                                                                                                                                                    
							this._sKeyBinding = "/" + this._sKeyBinding;		                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						oCurrentModel.setProperty(this._sKeyBinding, sValue, oCurrentContext);                                                                                                                                                                                   
					} else {                                                                                                                                                                                                                                                  
						sValue = oEvent.getParameter("selectedItem").getBindingContext().getProperty("Key");                                                                                                                                                                     
						if (this._bIsInt) {                                                                                                                                                                                                                                      
							sValue = parseInt(sValue, 10);                                                                                                                                                                                                                          
						}                                                                                                                                                                                                                                                        
						oCurrentModel.setProperty(oSourceBindingName, sValue, oCurrentContext);                                                                                                                                                                                  
					}                                                                                                                                                                                                                                                         
				                                                                                                                                                                                                                                                           
					if( this._sSecondaryBinding){                                                                                                                                                                                                                             
						sValue = oEvent.getParameter("selectedItem").getBindingContext().getProperty("SecondaryValue");                                                                                                                                                          
						if(!oCurrentContext){                                                                                                                                                                                                                                    
							this._sSecondaryBinding = "/" + this._sSecondaryBinding;		                                                                                                                                                                                              
						}                                                                                                                                                                                                                                                        
						oCurrentModel.setProperty(this._sSecondaryBinding, sValue, oCurrentContext);                                                                                                                                                                             
					}                                                                                                                                                                                                                                                         
				                                                                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
			this._sCurrentVHInput.fireChange();                                                                                                                                                                                                                         
			}                                                                                                                                                                                                                                                           
			                                                                                                                                                                                                                                                            
			                                                                                                                                                                                                                                                            
			this._oValueHelpDialog.destroy();                                                                                                                                                                                                                           
			this._oValueHelpDialog = null;                                                                                                                                                                                                                              
		},						                                                                                                                                                                                                                                                     
			                                                                                                                                                                                                                                                            
			                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			/**                                                                                                                                                                                                                                                         
			* Adds a history entry in the FLP page history                                                                                                                                                                                                              
			* @public                                                                                                                                                                                                                                                   
			* @param {object} oEntry An entry object to add to the hierachy array as expected from the ShellUIService.setHierarchy method                                                                                                                               
			* @param {boolean} bReset If true resets the history before the new entry is added                                                                                                                                                                          
			*/                                                                                                                                                                                                                                                          
			addHistoryEntry: (function() {                                                                                                                                                                                                                              
				var aHistoryEntries = [];                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
				return function(oEntry, bReset) {                                                                                                                                                                                                                          
					if (bReset) {                                                                                                                                                                                                                                             
						aHistoryEntries = [];                                                                                                                                                                                                                                    
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					var bInHistory = aHistoryEntries.some(function(entry) {                                                                                                                                                                                                   
						return entry.intent === oEntry.intent;                                                                                                                                                                                                                   
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
					if (!bInHistory) {                                                                                                                                                                                                                                        
						aHistoryEntries.push(oEntry);                                                                                                                                                                                                                            
						this.getOwnerComponent().getService("ShellUIService").then(function(oService) {                                                                                                                                                                          
							oService.setHierarchy(aHistoryEntries);                                                                                                                                                                                                                 
						});                                                                                                                                                                                                                                                      
					}                                                                                                                                                                                                                                                         
				};                                                                                                                                                                                                                                                         
			})()                                                                                                                                                                                                                                                        
		});                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
	}                                                                                                                                                                                                                                                             
);                                                                                                                                                                                                                                                             